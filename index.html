<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Caderno de Dívidas - SucessoCell</title>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    table { width: 100%; background: white; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #444; color: white; }
    td[contenteditable] { background: #fdfde3; }
    button { padding: 10px 20px; margin-top: 10px; }
    #senha-container { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  </style>
</head>
<body>

<div id="senha-container">
  <h2>Digite a senha para acessar</h2>
  <input type="password" id="senha" placeholder="Senha" />
  <button onclick="verificarSenha()">Entrar</button>
  <p id="erro" style="color:red;"></p>
</div>

<div id="conteudo" style="display:none;">
  <h1>Caderno de Dívidas - SucessoCell</h1>
  <table id="tabela">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Dívida (R$)</th>
        <th>Pago (R$)</th>
        <th>Falta (R$)</th>
        <th>Excluir</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="adicionarLinha()">Adicionar Linha</button>
</div>

<script>
const senhaCorreta = "030102";
const endpoint = "https://script.google.com/macros/s/AKfycbxt_8MZ7bCQkxi2HG-XzV33rCK5q-cHwmpM5_JKp-cgvSmqoc-aWxaYLHF8CQh-hAO8vg/exec";

function verificarSenha() {
  const senha = document.getElementById("senha").value;
  if (senha === senhaCorreta) {
    document.getElementById("senha-container").style.display = "none";
    document.getElementById("conteudo").style.display = "block";
    carregarDados();
  } else {
    document.getElementById("erro").innerText = "Senha incorreta";
  }
}

function criarLinha(nome = "", divida = "", pago = "") {
  const tr = document.createElement("tr");

  const tdNome = document.createElement("td");
  tdNome.contentEditable = true;
  tdNome.innerText = nome;

  const tdDivida = document.createElement("td");
  tdDivida.contentEditable = true;
  tdDivida.innerText = divida;

  const tdPago = document.createElement("td");
  tdPago.contentEditable = true;
  tdPago.innerText = pago;

  const tdFalta = document.createElement("td");
  tdFalta.innerText = calcularFalta(divida, pago);

  const tdExcluir = document.createElement("td");
  const btn = document.createElement("button");
  btn.innerText = "🗑️";
  btn.onclick = () => {
    tr.remove();
    salvarDados();
  };
  tdExcluir.appendChild(btn);

  tr.appendChild(tdNome);
  tr.appendChild(tdDivida);
  tr.appendChild(tdPago);
  tr.appendChild(tdFalta);
  tr.appendChild(tdExcluir);

  [tdNome, tdDivida, tdPago].forEach(cell => {
    cell.addEventListener("input", () => {
      tdFalta.innerText = calcularFalta(tdDivida.innerText, tdPago.innerText);
      salvarDados();
    });
  });

  return tr;
}

function calcularFalta(divida, pago) {
  const d = parseFloat(divida) || 0;
  const p = parseFloat(pago) || 0;
  return (d - p).toFixed(2);
}

function adicionarLinha() {
  const tr = criarLinha();
  document.querySelector("tbody").appendChild(tr);
  salvarDados();
}

function salvarDados() {
  const linhas = document.querySelectorAll("tbody tr");
  const dados = [];
  linhas.forEach(linha => {
    const tds = linha.querySelectorAll("td");
    dados.push({
      nome: tds[0].innerText,
      divida: tds[1].innerText,
      pago: tds[2].innerText
    });
  });

  fetch(endpoint, {
    method: "POST",
    body: JSON.stringify(dados),
    headers: { "Content-Type": "application/json" }
  })
  .then(r => r.text())
  .then(r => console.log("Salvo online:", r))
  .catch(e => alert("Erro ao salvar: " + e.message));
}

function carregarDados() {
  fetch(endpoint)
    .then(res => res.json())
    .then(dados => {
      const tbody = document.querySelector("tbody");
      tbody.innerHTML = "";
      dados.forEach(item => {
        const tr = criarLinha(item.nome, item.divida, item.pago);
        tbody.appendChild(tr);
      });
    })
    .catch(err => console.error("Erro ao carregar:", err));
}
</script>

</body>
</html>
